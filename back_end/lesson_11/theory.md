# Lesson 11

### 1. Обработка исключений Spring Boot REST API

Часто на практике возникает необходимость централизованной обработки исключений в рамках контроллера или даже всего приложения.
Изначально до Spring 3.2 основными способами обработки исключений в приложении были HandlerExceptionResolver и аннотация @ExceptionHandler.
Начиная с версии 3.2 появилась аннотация @ControllerAdvice, в которой устранены ограничения из предыдущих решений. А в Spring 5 добавился новый класс ResponseStatusException, который очень удобен для обработки базовых ошибок для REST API.

**Обработка исключений на уровне контроллера — @ExceptionHandler**

С помощью аннотации @ExceptionHandler можно обрабатывать исключения на уровне отдельного контроллера. Для этого достаточно объявить метод, в котором будет содержаться вся логика обработки нужного исключения, и проаннотировать его.

Основной недостаток @ExceptionHandler в том что он определяется для каждого контроллера отдельно, а не глобально для всего приложения. Это ограничение можно обойти если @ExceptionHandler определен в базовом классе, от которого будут наследоваться все контроллеры в приложении, но такой подход не всегда возможен, особенно если перед нами старое приложение с большим количеством легаси.

**HandlerExceptionResolver**
HandlerExceptionResolver является общим интерфейсом для обработчиков исключений в Spring. Все исключений выброшенные в приложении будут обработаны одним из подклассов HandlerExceptionResolver. Можно сделать как свою собственную реализацию данного интерфейса, так и использовать существующие реализации, которые предоставляет нам Spring из коробки.

Основной недостаток заключается в том что возвращается только код статуса, а на практике для REST API одного кода часто не достаточно. Желательно вернуть клиенту еще и тело ответа с описанием того что произошло. Эту проблему можно решить с помощью ModelAndView, но не нужно, так как есть способ лучше.


**ResponseStatusExceptionResolver**

ResponseStatusExceptionResolver — позволяет настроить код ответа для любого исключения с помощью аннотации @ResponseStatus.

Из недостатков такого подхода — как и в предыдущем случае отсутствует тело ответа. Но если нужно вернуть только код статуса, то @ResponseStatus довольно удобная штука.


**Обработка исключений с помощью @ControllerAdvice**

Начиная со Spring 3.2 можно глобально и централизованно обрабатывать исключения с помощью классов с аннотацией @ControllerAdvice.
Любой класс с аннотацией @ControllerAdvice является глобальным обработчиком исключений, который очень гибко настраивается.


### Валидация данных

Валидация данных при записи в базу данных — это важный шаг для обеспечения того, чтобы данные были корректными и соответствовали определённым правилам или ограничениям.
Spring предоставляет мощные инструменты для валидации данных на уровне приложения, прежде чем они будут сохранены в базу данных.
Вот основные аспекты валидации данных и аннотации, которые часто используются в Spring Data для этой цели:

### 1. JSR 303/JSR 380 (Bean Validation)

Это спецификации для валидации данных, которые Spring поддерживает через интеграцию с Hibernate Validator или другими реализациями Bean Validation. Эти аннотации можно применять непосредственно к полям сущностей или DTO (Data Transfer Objects).

#### Основные аннотации валидации:

- `@NotNull`: Поле не должно быть `null`.
- `@NotEmpty`: Поле не должно быть пустым. Применимо к коллекциям, строкам и массивам.
- `@NotBlank`: Поле должно содержать хотя бы один непробельный символ. Чаще всего используется для строк.
- `@Size(min = x, max = y)`: Ограничивает размер или длину элемента (например, строки или коллекции).
- `@Min(value = x)`: Значение должно быть не меньше `x`.
- `@Max(value = x)`: Значение должно быть не больше `x`.
- `@Email`: Поле должно содержать корректный email-адрес.
- `@Positive`: Значение должно быть положительным.
- `@Negative`: Значение должно быть отрицательным.

### 2. Валидация на уровне Spring MVC

Если вы используете Spring MVC, вы можете включить валидацию для параметров методов контроллера, используя аннотацию `@Valid` или `@Validated` перед объектом, который нужно валидировать.
Это приведёт к тому, что перед выполнением бизнес-логики объект будет проверен на соответствие ограничениям, указанным с помощью аннотаций Bean Validation.

### 3. Обработка ошибок валидации

После применения аннотаций валидации важно также уметь корректно обрабатывать ошибки валидации.
В Spring MVC, например, можно использовать класс `BindingResult` для обработки ошибок валидации, которые могут быть затем переданы во view для информирования пользователя.

### 4. Кастомная валидация

Вы можете создать свои собственные аннотации валидации и связанные с ними валидаторы для более специфичных или сложных валидационных правил, которые не покрываются стандартным набором аннотаций.

Используя эти механизмы валидации, вы можете значительно улучшить качество данных в вашем приложении, предотвращая сохранение некорректной или нежелательной информации в базу данных.

